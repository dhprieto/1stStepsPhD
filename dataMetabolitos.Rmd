---
title: "descripionTablas.Rmd"
output:
  html_document: default
  pdf_document: default
---

# Descripción datos

## Compuestos fenólicos (Procesado?)

Primero, se mide el efecto de agregar un endulzante determinado al zumo y se van haciendo medidas de metabolitos en diferentes tiempos y condiciones.Tenemos entonces dos factores que determinan el valor de los mg/100 ml de zumo, que serían las condiciones de toma de la muestra y el tipo de compuesto que se está midiendo.  

Medimos cuatro compuestos: 

* Derivados del Naringenin hexosido
- Eriodictiol hexosa
- Naringenin rutinosido 
- Hespertin rutinosido.

En primer lugar se extrae el área del cromatógrafo y se transforma en mg/100 ml de zumo, con la fórmula siguiente:

$$((AREA-221,08)/18129)*610,19*(0,1)$$

Se repite la medición cada 15 días, en condiciones de luz y oscuridad, a 5º y a 25º celsius de temperatura.

El procesado estadístico realizado en el excel adjuntado consiste en hacer la media y la desviación estándar de cada repetición hecha en las mismas condiciones. Después se calculan los mg totales de compuestos detectados por cada repetición, se hace la media y la SD, además de un porcentaje de pérdida respecto a la primera medida. Se replica en R (faltan los totales y la pérdida)

## Procesado y ordenamiento:

```{r Procesado, echo=TRUE}

# Funcion de procesado de tablas

procesado <- function(tabla, endulzante){
  
  tabla_num <- tabla[-1]
  
  # Se obtienen las medias de cada medida
  
  tabla_mean <- do.call(rbind, 
                        lapply(seq(1, nrow(tabla_num), 2), function(i){
                          x <- tabla_num[ i:(i + 1), , drop = FALSE]
                          res <- rbind(colSums(x)/2)
                          res
                        }))
  
  rownames(tabla_mean) <- unique(tabla$Condiciones)
  
  # La desviación estándar
  
  tabla_sd <- do.call(rbind, 
                      lapply(seq(1, nrow(tabla_num), 2), function(i){
                        x <- tabla_num[ i:(i + 1), , drop = FALSE]
                        res <- rbind(apply(x, 2, sd))
                        res
                      }))
  
  # Apilamos datos
  
  tabla_1 <- stack(as.data.frame(tabla_mean))
  tabla_1$Condiciones <- rep(unique(tabla$Condiciones),4)
  
  tabla_2 <- stack(as.data.frame(tabla_sd))
  tabla_2$Condiciones <- rep(unique(tabla$Condiciones),4)
  
  tabla_total <- merge(tabla_1, tabla_2, by = c("Condiciones", "ind"))
  
  tabla_total$Endulzante <- rep(endulzante, nrow(tabla_total))
  
  dplyr::rename(tabla_total, mean = values.x , SD = values.y, Compuesto = ind)
  
}

# ---- Lectura y procesado de las tablas

fenSU <- read.csv("data/Compuestos fenolicos SU VidaUtil Cronico_1.csv", sep = ";", dec = ",")
fenSA <- read.csv("data/Compuestos fenolicos SA VidaUtil Cronico_1.csv", sep = ";", dec = ",")
fenST <- read.csv("data/Compuestos fenolicos ST VidaUtil Cronico_1.csv", sep = ";", dec = ",")


fenSU_total <- procesado(fenSU, "SU")
fenSA_total <- procesado(fenSA, "SA")
fenST_total <- procesado(fenST, "ST")

fenFlavTotal <- rbind(fenSU_total, fenSA_total, fenST_total)

skimr::skim(fenFlavTotal)


```
## Pruebas adicionales

#### Normalidad

``` {r normalidad, echo = TRUE }


shapiro.test(fenFlavTotal$mean)


```

### Homocedasticidad

``` {r homocedasticidad, echo = TRUE }

var.test(x = fenFlavTotal[fenFlavTotal$Endulzante == "SA", "mean"],
         y = fenFlavTotal[fenFlavTotal$Endulzante == "SU", "mean"] )

var.test(x = fenFlavTotal[fenFlavTotal$Endulzante == "SA", "mean"],
         y = fenFlavTotal[fenFlavTotal$Endulzante == "ST", "mean"] )

var.test(x = fenFlavTotal[fenFlavTotal$Endulzante == "ST", "mean"],
         y = fenFlavTotal[fenFlavTotal$Endulzante == "SU", "mean"] )

```


### 2WAY-ANOVA

Dado que comparamos dos variables independientes cualitativas y una variable
dependiente cuantitativa

#### Box-plot

```{r box-plot, echo=TRUE}

library("ggplot2")
library("gridExtra")

ggplot(data = as.data.frame(fenFlavTotal), aes(x = Endulzante, y = mean, color = Endulzante)) +
  geom_boxplot() +
  theme_bw()

p1 <- ggplot(data = as.data.frame(fenFlavTotal), aes(x = Endulzante, y = mean)) + 
  geom_boxplot() + theme_bw()
p2 <- ggplot(data = as.data.frame(fenFlavTotal), aes(x = Condiciones, y = mean)) +
  geom_boxplot() + theme_bw()
p3 <- ggplot(data = as.data.frame(fenFlavTotal), aes(x = Endulzante, y = mean, colour = Condiciones)) +
  geom_boxplot() + theme_bw()

grid.arrange(p1, p2, ncol = 2)
p3

```



### Dudas

Hesperidina?

## Muestras bio

### Cronico Orina Atipicos

### Cronico plasma Atipicos


